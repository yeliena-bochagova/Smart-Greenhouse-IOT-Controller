@model SmartGreenhouse.Web.Models.GreenhouseState

<div class="container">
    <div class="d-flex justify-content-between align-items-center my-4">
        <h2>üåø –¢–µ–ø–ª–∏—Ü—è: –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è</h2>
    </div>

    <div class="card p-3 mb-4 bg-light">
        <form asp-action="UpdateAll" method="post" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label>–®–∏—Ä–æ—Ç–∞ (Lat)</label>
                <input type="text" name="lat" value="@Model.Latitude" class="form-control" />
            </div>
            <div class="col-md-3">
                <label>–î–æ–≤–≥–æ—Ç–∞ (Lon)</label>
                <input type="text" name="lon" value="@Model.Longitude" class="form-control" />
            </div>
            <div class="col-md-3">
                <label>–û–±'—î–º (m¬≥)</label>
                <input type="number" name="volume" value="@Model.Volume" class="form-control" />
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">–û–Ω–æ–≤–∏—Ç–∏ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è</button>
            </div>
        </form>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h4 class="text-success">üè† –í—Å–µ—Ä–µ–¥–∏–Ω—ñ (Real-time)</h4>
            <table class="table table-bordered">
                <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–ó–Ω–∞—á–µ–Ω–Ω—è</th></tr>
                <tr><td>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</td><td><span id="in-temp">@Model.InsideTemp.ToString("F1")</span> ¬∞C</td></tr>
                <tr><td>–í–æ–ª–æ–≥—ñ—Å—Ç—å</td><td><span id="in-hum">@Model.InsideHumidity.ToString("F0")</span> %</td></tr>
                <tr><td>–û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è</td><td><span id="in-light">@Model.InsideLight.ToString("F0")</span> lx</td></tr>
            </table>
            
            <div class="d-grid gap-2">
                <form asp-action="ToggleHeater" class="d-inline">
                    <button class="btn @(Model.IsHeaterOn ? "btn-success" : "btn-secondary") w-100 mb-1">üî• –û–±—ñ–≥—Ä—ñ–≤: @(Model.IsHeaterOn ? "ON" : "OFF")</button>
                </form>
                <form asp-action="ToggleVentilation" class="d-inline">
                    <button class="btn @(Model.IsVentilationOn ? "btn-success" : "btn-secondary") w-100 mb-1">üí® –í–µ–Ω—Ç–∏–ª—è—Ü—ñ—è: @(Model.IsVentilationOn ? "ON" : "OFF")</button>
                </form>
                <div class="btn-group w-100">
                    <form asp-action="Water" class="w-50"><button class="btn btn-info w-100">üíß –ü–æ–ª–∏–≤</button></form>
                    <form asp-action="AddLight" class="w-50"><button class="btn btn-warning w-100">üí° –°–≤—ñ—Ç–ª–æ</button></form>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <h4 class="text-primary">üåç –ó–∑–æ–≤–Ω—ñ (API)</h4>
            <table class="table table-dark">
                <tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>–ó–Ω–∞—á–µ–Ω–Ω—è</th></tr>
                <tr><td>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</td><td><span id="out-temp">@(Model.OutsideTemp?.ToString("F1") ?? "N/A")</span> ¬∞C</td></tr>
                <tr><td>–í–æ–ª–æ–≥—ñ—Å—Ç—å</td><td><span id="out-hum">@(Model.OutsideHumidity?.ToString("F0") ?? "N/A")</span> %</td></tr>
                <tr><td>–†–∞–¥—ñ–∞—Ü—ñ—è/–°–≤—ñ—Ç–ª–æ</td><td><span id="out-light">@(Model.OutsideIlluminance?.ToString("F0") ?? "N/A")</span> lx</td></tr>
            </table>
            <div class="mt-3">
               <a asp-controller="Subroutine3" asp-action="Index" class="btn btn-outline-dark w-100">
        üìú –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –ª–æ–≥—ñ–≤
    </a>
            </div>
            <div class="mt-3">
    <a asp-controller="Auth" asp-action="Profile" class="btn btn-outline-dark w-100">
        ‚¨Ö –ù–∞–∑–∞–¥ –¥–æ –ø—Ä–æ—Ñ—ñ–ª—é
    </a>
</div>
        </div>
    </div>
</div>

<script>
    // –§—É–Ω–∫—Ü—ñ—è –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∫–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É (1000 –º—Å)
    setInterval(() => {
        fetch('/Subroutine2/GetSystemState') // –°—Ç—É–∫–∞—î–º–æ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä
            .then(response => response.json()) // –ß–∏—Ç–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —è–∫ JSON
            .then(data => {
                // –û–Ω–æ–≤–ª—é—î–º–æ —Ü–∏—Ñ—Ä–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                // data.insideTemp - —Ü–µ –Ω–∞–∑–≤–∞ –∑–º—ñ–Ω–Ω–æ—ó, —Ç—ñ–ª—å–∫–∏ –∑ –º–∞–ª–µ–Ω—å–∫–æ—ó –ª—ñ—Ç–µ—Ä–∏ (camelCase)
                
                document.getElementById('in-temp').innerText = data.insideTemp.toFixed(1);
                document.getElementById('in-hum').innerText = data.insideHumidity.toFixed(0);
                document.getElementById('in-light').innerText = data.insideLight.toFixed(0);

                if(data.outsideTemp !== null) 
                    document.getElementById('out-temp').innerText = data.outsideTemp.toFixed(1);
                
                if(data.outsideHumidity !== null)
                    document.getElementById('out-hum').innerText = data.outsideHumidity.toFixed(0);

                if(data.outsideIlluminance !== null)
                    document.getElementById('out-light').innerText = data.outsideIlluminance.toFixed(0);
            })
            .catch(error => console.error('Error updating data:', error));
    }, 1000);
</script>